<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>org.archive.io.arc package</title>
</head>
<body>
Experimental WARC Writer and Readers.  Code and specification subject to change.
Code implemented against (unreleased)
<a href="http://archive-access.sourceforge.net/warc/warc_file_format.html">WARC
File Format (Version 0.9)</a>.
<h2>Implementation Notes</h2>

<h3>Unique ID Generator</h3>
<p>WARC requires a GUID for each record written. A configurable 
unique ID {@link org.archive.uid.GeneratorFactory}, it can be configured
to use alternate unique ID generators, was added with a default of
{@link org.archive.uid.UUIDGenerator}.  Generates
<a url="http://en.wikipedia.org/wiki/UUID">UUIDs</a> (using java5
<code>java.util.UUID</code>) and formats them in accordance with
<a href="http://ietf.org/rfc/rfc4122.txt">RFC4122</a>.
See {@link org.archive.uid}.</p>

<h3>{@link org.archive.util.anvl ANVL}</h3>
<p>The ANVL RFC822-like format is used writing <code>Named Fields</code> in
WARCs and occasionally for metadata. An (as yet incomplete) implementation was
added at {@link org.archive.util.anzl}.
</p>

<h3>warcinfo</h3>
<p>For <code>warcinfo</code> type, what to use for URL?  Implementation writes
the <code>Record-ID</code> as URL.  Also, introduces an optional
<code>Named Field</code> with label <code>WARCFilename</code> for name of the
WARC file this <code>warcinfo</code> record is present in. Justifications:
original filename gets mangled or reading a WARC stream in context where
filename is not available: E.g. Marking an index with name of WARC in which
subsequent records can be found.
</p>

<h3>Miscellaneous</h3>
<p>Writing WARCs, the <code>resource</code> record type is chosen as the core
record that all others associate to: i.e. all others 
have a <code>Related-Record-ID</code> that points back to the
<code>resource</code>.
</p>
<p>Currently length has leading zeros to emphasize the length fields
fixed-lengthed-ness.
</p>
<h2>Suggested Spec. Amendments</h2>
<h3>mimetype in header line</h3>
<p>Lets change spec. so full mimetypes are allowed as per RFC2045 rather than
our current shriveled header line mimetype that allows only type and subtype.
Let mimetypes have <i>parameters</i>: e.g.
<code>text/plain; charset=UTF-8</code> or
<code>application/http; msgtype=request</code>.  
If we allowed full mimetypes, we could support the following scenarios without
parsers having to resort to <code>metadata</code> record or to custom
<code>Named Fields</code> to figure interpreting content:
<ul>
<li>Consider the case where an archiving organization would store all
related to a capture as one record with a mimetype of 
<code>multipart/mixed; boundary=RECORD-ID</code>.  An example record
might comprise the parts 
<code>Content-Type: application/http; msgtype=request</code>,
<code>Content-Type: application/http; msgtype=response</code>, and
<code>Content-Type: text/xml+rdf</code> (For metadata).
</li>
<li>Or, an archiving institution would store a capture with
<code>multipart/alternatives</code> perhaps ranging from
most basic (or 'desiccated' in Kunze-speak)
-- perhaps a <code>text/plain</code> rendition of a PDF capture -- through to
<code>best</code>, the actual PDF binary itself.
</li>
</ul>
</p>
<p>To support, we should allow spaces between parameters and that parameter
values themselves might include spaces ('quoted-string').  Parse would be easy
especially considering position in header line, second to last, just before 
record-id URI but would be easier if mimetype were last -- easier to implement
and easier to document in spec.  
</p>
<h3>Use application/http instead of message/http</h3>
<p>message type has line length maximum of 1000 characters absent a
<code>Content-Type-Encoding</code> header set to <code>BINARY</code>.
(See definition of message/http for talk of adherence to MIME
<code>message</code> line limits).
</p>
<h3>Drop response record type</h3>
<p><code>resource</code> is sufficent. Let mimetype distingush if capture with
response headers or not (As per comment at end of <i>8.1 HTTP and HTTPS</i>
where it allows that if no response headers, use resource record and
page mimetype rather than request + a mimetype of message/http.)</p>
<p>Are there other collection types that would require a response record,
that don't have a mimetype that includes response headers and content?
SMTP has rich MIME set to describe responses. Its request is
pretty much unrecordable. NNTP and FTP similar, so it wouldn't need
explicit 'response' type.</p>
<p>Related, do we need the <code>request</code> record?
Only makes sense for HTTP?</p>

<h3>Edits</h3>
<p>Below are suggested edits rather than substantative changes.
</p>
<h4>Allow multiple instances of a single Named Parameter</h4>
<p>Allow that there may be multiple instances of same Named Parameter.
E.g. Multiple <code>Related-Record-ID</code>s could prove of use.
Spec. mentions this in <i>8.1 HTTP and HTTPS</i> section but better
belongs in the <i>5.2 Named Parameters</i> preamble.
</p>
<p>Related, add to <code>Named Field</code> section note on bidirectional
<code>Related-Record-ID</code>.</p>

<h4>Miscellaneous</h4>
<ul>
<li>Should we allow a <code>Description</code> <code>Named Field</code>.
E.g. I add an order file as a metadata record and associate with a
<code>warcinfo</code> record.  Description field could say "This is Heritrix
Order file".  Same for seeds.  Alternative is custom XML packaging (Scheme
could describe fields such as 'order' file or ANVL packaging using ANVL
'comments'.
</li>
<li>Should we allow freeform creation of custom named fields if
have a 'X-' or somesuch prefix?
</li>
<li>Leave off 9.2 GZIP extra fields. Big section on implementing an option
that has little to do with WARCing.</li>
<li>But, we need to marking gzipped files as being WARC -- i.e. a member per
resource -- is useful to readers. Suggest extra field that says 'WARC'.</li>

<li>IP-Address for dns resource is DNS Server.  Add note to 8.2 DNS.
</li>

<li>Section 6. truncated?</li>

<li>Section 7, on truncation, on 7.1, suggest values but allow free form
description?
Leave off 'superior method of indicating truncation' paragraph.  This qualifier
could be added to all sections of doc. -- that a subsequent revision will have
a superior means. Rather than <code>End-Length</code>, like MIME, last record could have
<code>Segment-Number-Total</code>, a count of all segments that make up
complete record.
</li>
<li>Section 11, why was it we said we don't need a parameter for special gzip
WARC format?  I don't remember?   Reader needs to know when its reading a
stream.  A client would like to know so it wrote stream to disk with right
suffix?  Recap.</li>
<li>Nothing on header-line encoding (Section 11 says UTF-8). 
For completeness should be US-ASCII
or UTF-8, no control-chars or CR or LF, etc.</li>
<li>In-line ANVL definition (From Kunze).  Related, can labels have
CTLs such as CRLF (Shouldn't)?  When says 'control-chars', does this include
UNICODE control characters (Should)? CHAR is described as ASCII/UTF-8 but they
are not same (Should be UTF-8)</li>
<li>Fix examples. Use output of experimental ARC Writer.</li>
<li>Fix ambiguity in spec. pertaining to 'smallest possible anvl-fields' notcited by Mads Alhof Kristiansen in <a 
href="ftp://ftp.diku.dk/diku/semantics/papers/D-548.pdf">Digital Preservation
using the WARC File Format</a>.
</li>
<li>Minor: Length may be followed optionally by length to end-of-header and to
end-of-named-fields colon delimited.  Makes parse easier.</li>
<li>Requiring that the Revisit record have the

</ul>

<h2>TODOs</h2>
<ul>
<li>WARCReader</li>
<li>WARC2ARC</li>
<li>unit tests using <code>multipart/*</code> (JavaMail) reading and writing
records? Try <code>record-id</code> as part boundary.
</li>

<li><code>warcinfo</code>
<ul><li>What for a scheme?  Using UUID as per G suggestion.  In the past
we used to get the filename from this URL header field.  Won't be able to do
that with UUID for URL.  So, introducing new warcinfo Named Field (optional)
'Filename' that will be used when warcinfo is put at start of a file.
</li>
<li>Also, how to populate description of crawl into warcinfo?
'Documentation' <code>Named Field</code> with list of URLs that can be assumed
to exist somewhere in the current WARC set (We'd have to make the crawler go
get them at start of a crawl).
</li>
<li>I don't want to repeat crawl description for every WARC. How to have this
warcinfo point at an original? 
<code>related-record-id</code> seems insufficent.
</li>
<li>If the crawler config. changes, can I just write a warcinfo with
differences?  How to express?  Or better as metadata about a warcinfo?
</li>
<li><code>revisit</code>
<ul>
<li>What to write?  Use description field? Example has request header
(inside XML).  Better to use associated <code>request</code> record for this
kind of info?</li>
<li><code>Related-Record-ID</code> (RRID) of original is likely
an onerous requirement. Envisioning an implementation where we'd write
<code>revisit</code> records, we'd write such a record where content was
judged same or where date since last fetch had not changed.  If we're to
write the RRID, then we'd have to maintain table keyed by URL with value of
page hash or of last modified-date plus associated RRID (actual RRID, not
hash).</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Unimplemented</h2>
<ul>
<li>4.2 <code>response</code>. May not be needed.</li> 
<li>Record Segmentation (4.8 <code>continuation</code> record type
and the 5.2 <code>Segment-*</code> Named Parameters.  Future TODO.</li>
<li>4.7 <code>conversion</code> type. Future TODO.</li>
<li>9.2 GZIP extra field to mark this gzip as list of GZIP members rather than
a big gzip bundle. Future TODO.</li> 
</ul>
</body>
</html>
