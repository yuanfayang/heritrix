<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>org.archive.io.arc package</title>
</head>
<body>
Experimental WARC Writer and Readers.  Code and specification subject to change.
Code implemented against (unreleased)
<a href="http://archive-access.sourceforge.net/warc/warc_file_format.html">WARC
File Format (Version 0.9)</a>.
<h2>Implementation Notes</h2>
<h3>Note on UUIDGenerator</h3>
<p>WARC requires a GUID for each record written. A configurable 
unique ID {@link org.archive.uid.GeneratorFactory}  -- it can be configured
to use alternate unique ID generators -- was added with a default of
{@link org.archive.uid.UUIDGenerator}.  Generates
<a url="http://en.wikipedia.org/wiki/UUID">UUIDs</a> (using java5
java.util.UUID) and formats them in accordance with
<a href="http://ietf.org/rfc/rfc4122.txt">RFC4122</a>.
See {@link org.archive.uid}.</p>

<h3>Note on {@link org.archive.util.anvl ANVL} Implementation</h3>
<p>The ANVL RFC822-like format is used writing Named Fields in WARCs and
occasionally for metadata. An implementation was added at
{@link org.archive.util.anzl}.
</p>

<h3>Miscellaneous</h3>
<p>Writing WARCs, made <code>resource</code> as record all others
<code>Related-Record-ID</code> too.
Makes sense putting request or metadata in center of link web since not
always going to instances of either, etc.
</p>
<p>Length has leading zeros to emphasize fixed-lengthed-ness.
</p>
<h2>Suggested Spec. Amendments</h2>
<p>We start with the substantial.</p>
<h3>mimetype in header line</h3>
<p>Lets change spec so proper mimetypes are allowed as per RFC2045 rather than
our current shriveled definition. Let mimetypes have parameters allowing 
space between subtype and first parameter and that parameter
values themselves might include spaces ('quoted-string'). Parse is easy
especially considering position in header line, second to last, just before 
record-id URI (Would be easier if mimetype were last -- easier to implement
and easier to document in spec).  Would allow full exploitation of mime type.
Otherwise, parsers need to read mime + custom named field or metadata.</p>  
<p>If we allow full mimetype spec., using mimetype 'naturally', we leave
ourselves open to recording of the following scenarios without amendment to
the spec:
</p>
<p>
<ul>
<li>Consider the case where an archiving organization would store all
related to a capture as one record with a mimetype of 
<code>multipart/mixed; boundary=RECORD-ID</code> and into this record they'd
write parts <code>Content-Type: application/http; msgtype=request</code>,
<code>Content-Type: application/http; msgtype=response</code>, and
<code>Content-Type: text/xml+rdf</code> (For metadata).
</li>
<li>Or, an archiving institution would store a capture with 'alternatives'
(perhaps ranging from <code>basic/plain</code> (or 'desiccated' in Kunze-speak)
-- perhaps a <code>text/plain</code> rendition of a PDF capture -- through to
<code>best</code>, the actual PDF binary itself.
</li>
</ul>
</p>
<h3>Use application/http instead of message/http</h3>
<p>message type has line length maximum of 1000 characters absent a
<code>Content-Type-Encoding</code> header set to <code>BINARY</code>.
(See definition of message/http for talk of adherence to MIME
<code>message</code> line limits).
</p>
<h3>Drop response record type</h3>
<p><code>resource</code> is sufficent. Let mimetype distingush if capture with
response headers or not (As per comment at end of <i>8.1 HTTP and HTTPS</i>
where it allows that if no response headers, use resource record and
page mimetype rather than request + a mimetype of message/http.)</p>
<p>Are there other collection types that would require a response record,
that don't have a mimetype that includes response headers and content?
SMTP has rich MIME set to describe responses so it wouldn't need
explicit 'response' type.  NNTP similar.</p>
<p>Do we need the request record?  Only makes sense for HTTP?</p>

<h3>Suggested Spec edits</h3>
<h4>Allow multiple instances of a single Named Parameter</h4>
<p>Allow that there may be multiple instances of same Named Parameter.
E.g. Multiple <code>Related-Record-ID</code>s could prove of use.
Spec. mentions this in <i>8.1 HTTP and HTTPS</i> section but better
belongs in the <i>5.2 Named Parameters</i> preamble.
</p>
<h4>Miscellaneous</h4>
<ul>
<li>Leave off 9.2 GZIP extra fields. Big section on implementing an option
that has little to do with WARCing.</li>
<li>IP-Address for dns resource is DNS Server.  Add note to 8.2 DNS.
</li>
<li>Section 6. truncated?</li>
<li>Section 7, on truncation, on 7.1, suggest values but allow free form description?
Leave off 'superior method of indicating truncation' paragraph.  This qualifier
could be added to all sections of doc. -- that a subsequent revision will have
a superior means. Rather than <code>End-Length</code>, like MIME, last record could have
<code>Segment-Number-Total</code>, a count of all segments that make up
complete record.
</li>
<li>Section 11, why was it we said we don't need a parameter for special gzip
WARC format?  I don't remember?   Reader needs to know when its reading a
stream.  A client would like to know so it wrote stream to disk with right
suffix?  Recap.</li>
<li>Nothing on header-line encoding (Section 11 says UTF-8). 
For completeness should be US-ASCII
or UTF-8, no control-chars or CR or LF, etc.</li>
<li>In-line ANVL definition (From Kunze).  Related, can labels have
CTLs such as CRLF (Shouldn't)?  When says 'control-chars', does this include
UNICODE control characters (Should)? CHAR is described as ASCII/UTF-8 but they
are not same (Should be UTF-8)</li>
<li>Fix examples. Use output of experimental ARC Writer.</li>
<li>Should we allow freeform creation of custom named fields if
have a 'X-' or somesuch prefix?
</li>
<li>Fix ambiguity in spec. pertaining to 'smallest possible anvl-fields' notcited by Mads Alhof Kristiansen in <a 
href="ftp://ftp.diku.dk/diku/semantics/papers/D-548.pdf">Digital Preservation
using the WARC File Format</a>.
</li>
<li>Minor: Length may be followed optionally by length to end-of-header and to
end-of-named-fields colon delimited.  Makes parse easier.</li>
</ul>

<h2>TODOs</h2>
<ul>
<li>warcinfo</li>
<li>Revisit (Don't forget required RRID)</li>
<li>Truncation</li>
<li>WARCReader</li>
<li>WARC2ARC</li>
<li>unit tests using <code>multipart/*</code> (JavaMail) reading and writing
records? Try <code>record-id</code> as part boundary.
</li>
<li><b>warcinfo</b>
<ul><li>What for a scheme?  Spec. is lacking.  DK used 'file' for
a 'resource'.  Am using 'data' with value of ARC filename.
</li>
<li>I don't want to repeat for every WARC. How to have this warcinfo point at
an original?  <code>related-record-id</code> seems insufficent.
</li>
<li>If the crawler config. changes, can I just write a warcinfo with
differences?  How to express?  Or better as metadata about a warcinfo?
</li>
</ul>
</li>
</ul>
<h2>Unimplemented</h2>
<ul>
<li>4.2 <code>response</code></li> 
<li>Record Segmentation (4.8 <code>continuation</code> record type
and the 5.2 <code>Segment-*</code> Named Parameters</li>
<li>4.7 <code>conversion</code> type.</li>
<li>5.2 <code>Warcinfo*</code> Named Parameters</li>
<li>9.2 GZIP extra field</li> 
</ul>
</body>
</html>
