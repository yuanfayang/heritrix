<?xml version="1.0" encoding="UTF-8"?>

<!--Have cruisecontrol call out to this delegating ant script.
    It gives us more control over what gets done since the 
    cruisecontrol schedule is limited in that you can only 
    call one target.
 -->

<project name="HEAD-heritrix" default="build" 
        basedir="checkout/HEAD-heritrix">
    <!--Shouldn't have to change anything below here. -->

    <property name="maven.home" value="/home/stack/bin/maven" />

    <target name="build">
        <!-- Get the latest from CVS -->
        <cvs command="up -d -P"/>

        <!-- Write timestamp build suffix into build.properties -->
        <propertyfile file="build.properties"
                comment="Updated by ${ant.project.name}">
            <entry  key="version.build.timestamp" type="date" value="now"
                pattern="yyyyMMddHHmm"/>
            <entry  key="version.build.suffix"
                value="-${version.build.timestamp}" />
        </propertyfile>

        <!--Call maven to build distribution and update site.
            Use antcall so that we read the just written build.properties
            (Otherwise, version.build.suffix will have the previous value, 
            not the one just written above).
        -->
        <antcall target="maven"/>
    </target>

    <target name="maven">
        <exec failonerror="true" executable="${maven.home}/bin/maven">
            <arg value="clean" />
            <arg value="dist" />
            <arg value="war" />
            <arg value="selftest" />
            <arg value="site:generate" />
            <arg value="site:update-sourceforge" />
        </exec>
    </target>
</project>
